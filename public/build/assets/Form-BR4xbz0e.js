import{r as m,j as e,L as O,$ as Q,S as D}from"./app-DfJ_0T5P.js";import{c as E,B as p,I as g}from"./index-DEqMiAcq.js";import{C as _,a as N,b,c as S}from"./card-rQGJHwBd.js";import{L as h}from"./label-CtxzNBfp.js";import{S as V}from"./separator-D_PXpKir.js";import{S as W}from"./switch-D36FxMCC.js";import{T as Y}from"./textarea-D9XiKQvr.js";import{A as Z}from"./admin-layout-Byyw_wh_.js";import{A as ee}from"./arrow-left-Bw5KyC4a.js";import{S as se}from"./save-CnGxLfs1.js";import{X as ae}from"./use-initials-CmAI_RPG.js";import{P as ie}from"./plus-D-i3DEqe.js";import{M as re}from"./minus-BHDYopVt.js";/* empty css            */import"./app-sidebar-header-C3rPOE4j.js";import"./app-logo-icon-mCD171Gr.js";import"./breadcrumb-DgmfOwcT.js";import"./Combination-NavuyeJM.js";import"./index-idKdAdSb.js";import"./package-DjSAMqdm.js";import"./pencil-D0_0NsiU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ne=E("Star",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ce=E("Upload",le);function $e({product:i,isEdit:x=!1}){var P,C,F,I;const T=((P=i==null?void 0:i.images)==null?void 0:P.map(s=>({id:s.id,url:s.image_url||`/storage/${s.image}`,is_primary:s.is_primary,is_new:!1})))||[],[o,j]=m.useState(T),[y,A]=m.useState([]),[f,v]=m.useState(((F=(C=i==null?void 0:i.images)==null?void 0:C.find(s=>s.is_primary))==null?void 0:F.id)||null),[n,d]=m.useState({name:(i==null?void 0:i.name)||"",slug:(i==null?void 0:i.slug)||"",description:(i==null?void 0:i.description)||"",price:(i==null?void 0:i.price)||0,is_active:(i==null?void 0:i.is_active)??!0,sizes:((I=i==null?void 0:i.sizes)==null?void 0:I.map(s=>({id:s.id,size:s.size,stock:s.stock})))||[{size:"",stock:0}],deleted_image_ids:[],primary_image_id:null,new_images:[]}),[me,w]=m.useState({}),[oe,k]=m.useState(!1);m.useEffect(()=>{d(s=>({...s,deleted_image_ids:y}))},[y]),m.useEffect(()=>{d(s=>({...s,primary_image_id:f}))},[f]),m.useEffect(()=>{const s=o.filter(a=>a.is_new&&a.file).map(a=>a.file);d(a=>({...a,new_images:s}))},[o]);const U=[{title:"Dasbor",href:"/admin/dashboard"},{title:"Produk",href:"/admin/products"},{title:x?"Edit Produk":"Tambah Produk",href:x?`/admin/products/${i==null?void 0:i.id}/edit`:"/admin/products/create"}],G=s=>{const a=s.target.files;if(!a||a.length===0)return;const t=Array.from(a),l=[];t.forEach(r=>{const c=new FileReader;c.onload=$=>{var L;if((L=$.target)!=null&&L.result){const X={url:$.target.result,is_primary:o.length===0&&l.length===0,is_new:!0,file:r};j(q=>[...q,X])}},c.readAsDataURL(r)}),s.target.value=""},M=s=>{const a=o[s];a.id&&!a.is_new&&(A(t=>[...t,a.id]),f===a.id&&v(null)),j(t=>t.filter((l,r)=>r!==s))},B=s=>{const a=o[s];j(t=>t.map((l,r)=>({...l,is_primary:r===s}))),a.id&&!a.is_new?v(a.id):v(null)},H=()=>{if(typeof n.name=="string"){const s=n.name.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-");d(a=>({...a,slug:s}))}},R=()=>{d(s=>({...s,sizes:[...s.sizes,{size:"",stock:0}]}))},J=s=>{d(a=>({...a,sizes:a.sizes.filter((t,l)=>l!==s)}))},z=(s,a,t)=>{d(l=>{const r=[...l.sizes];return r[s]={...r[s],[a]:t},{...l,sizes:r}})},K=s=>{s.preventDefault(),k(!0);const a=new FormData;a.append("name",n.name),a.append("slug",n.slug),a.append("description",n.description),a.append("price",n.price.toString()),a.append("is_active",n.is_active?"1":"0"),n.sizes.forEach((r,c)=>{r.id&&a.append(`sizes[${c}][id]`,r.id.toString()),a.append(`sizes[${c}][size]`,r.size),a.append(`sizes[${c}][stock]`,r.stock.toString())}),y.forEach((r,c)=>{a.append(`deleted_image_ids[${c}]`,r.toString())}),f!==null&&a.append("primary_image_id",f.toString()),o.filter(r=>r.is_new&&r.file).map(r=>r.file).forEach((r,c)=>{a.append(`new_images[${c}]`,r)});const l={preserveScroll:!0,preserveState:!0,onSuccess:()=>{k(!1),w({})},onError:r=>{k(!1),w(r)}};x&&(i!=null&&i.id)?(a.append("_method","PUT"),D.post(`/admin/products/${i.id}`,a,l)):D.post("/admin/products",a,l)},u=(s,a)=>{d(t=>({...t,[s]:a}))};return e.jsxs(Z,{breadcrumbs:U,children:[e.jsx(O,{title:x?"Edit Produk":"Tambah Produk"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:x?"Edit Produk":"Tambah Produk"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{variant:"outline",asChild:!0,children:e.jsxs(Q,{href:"/admin/products",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Kembali ke Produk"]})}),e.jsxs(p,{type:"submit",form:"product-form",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Simpan Produk"]})]})]}),e.jsx(V,{}),e.jsxs("form",{id:"product-form",onSubmit:K,className:"space-y-6",children:[e.jsxs(_,{children:[e.jsx(N,{children:e.jsx(b,{children:"Informasi Dasar"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"name",children:"Nama Produk"}),e.jsx("div",{className:"space-y-1",children:e.jsx(g,{id:"name",type:"text",value:n.name,onChange:s=>u("name",s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"slug",children:"Slug"}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{id:"slug",type:"text",value:n.slug,onChange:s=>u("slug",s.target.value)}),e.jsx(p,{type:"button",variant:"outline",onClick:H,children:"Generate"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"price",children:"Harga"}),e.jsx("div",{className:"space-y-1",children:e.jsx(g,{id:"price",type:"number",min:"0",value:n.price,onChange:s=>u("price",s.target.value)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Deskripsi"}),e.jsx("div",{className:"space-y-1",children:e.jsx(Y,{id:"description",value:n.description,onChange:s=>u("description",s.target.value),rows:5})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"is_active",checked:n.is_active,onCheckedChange:s=>u("is_active",s)}),e.jsx(h,{htmlFor:"is_active",children:"Produk Aktif"})]})]})]}),e.jsxs(_,{children:[e.jsx(N,{children:e.jsx(b,{children:"Gambar Produk"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(h,{htmlFor:"images",className:"border-border hover:bg-muted flex h-32 w-full cursor-pointer flex-col items-center justify-center gap-1 rounded-lg border-2 border-dashed transition-colors",children:[e.jsx(ce,{className:"h-8 w-8"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Klik untuk mengunggah gambar"}),e.jsx("span",{className:"text-muted-foreground text-xs",children:"PNG, JPG atau JPEG (maks. 2MB)"})]}),e.jsx(g,{id:"images",type:"file",accept:"image/png,image/jpeg,image/jpg",multiple:!0,className:"hidden",onChange:G})]}),o.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4",children:o.map((s,a)=>e.jsxs("div",{className:`group relative aspect-square overflow-hidden rounded-lg border ${s.is_primary?"ring-primary ring-2":""}`,children:[e.jsx("img",{src:s.url,alt:"",className:"h-full w-full object-cover"}),e.jsxs("div",{className:"bg-background/80 absolute inset-0 flex items-center justify-center gap-2 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx(p,{type:"button",variant:"secondary",size:"icon",onClick:()=>B(a),disabled:s.is_primary,children:e.jsx(ne,{className:s.is_primary?"fill-primary":""})}),e.jsx(p,{type:"button",variant:"destructive",size:"icon",onClick:()=>M(a),children:e.jsx(ae,{className:"h-4 w-4"})})]})]},a))})]})]}),e.jsxs(_,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Ukuran dan Stok"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Semua produk harus memiliki minimal satu ukuran dengan stok"})]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:R,children:[e.jsx(ie,{className:"mr-1 h-4 w-4"}),"Tambah Ukuran"]})]}),e.jsx(S,{className:"space-y-4",children:n.sizes.map((s,a)=>e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(h,{htmlFor:`size-${a}`,children:"Ukuran"}),e.jsx(g,{id:`size-${a}`,type:"text",value:s.size,onChange:t=>z(a,"size",t.target.value),placeholder:"S, M, L, XL, dll."})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(h,{htmlFor:`stock-${a}`,children:"Stok"}),e.jsx(g,{id:`stock-${a}`,type:"number",min:"0",value:s.stock,onChange:t=>z(a,"stock",t.target.value)})]}),e.jsx(p,{type:"button",variant:"outline",size:"icon",onClick:()=>J(a),disabled:n.sizes.length===1,children:e.jsx(re,{className:"h-4 w-4"})})]},a))})]})]})]})]})}export{$e as default};
