import{r as m,j as e,L as O,$ as Q,S as E}from"./app-Q9dS00et.js";import{c as L,B as g,I as p}from"./index-BQZf-uuE.js";import{C as N,a as _,b,c as S}from"./card-BENBHJW0.js";import{L as o}from"./label-B7e3O9AC.js";import{S as V}from"./separator-Cr2X9xzZ.js";import{S as W}from"./switch-3NzrX7ZZ.js";import{T as Y}from"./textarea-Bj_ySKTN.js";import{A as Z}from"./admin-layout-BNJm122k.js";import{A as ee}from"./arrow-left-TJOcjJTI.js";import{S as se}from"./save-BmQZlouh.js";import{X as ae}from"./use-initials-DGQhOcWX.js";import{P as ie}from"./plus-DCeUEkMi.js";import{M as re}from"./minus-DjreWIEV.js";/* empty css            */import"./app-sidebar-header-CBy8gzWG.js";import"./app-logo-icon-Dqw-noQ_.js";import"./breadcrumb-DHuIZVg7.js";import"./Combination-DF2WeoPk.js";import"./index-BHMeM5Ko.js";import"./package-Dd6V2RS6.js";import"./pencil-DFKxRa2o.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ne=L("Star",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ce=L("Upload",le);function $e({product:i,isEdit:j=!1}){var P,C,F,I;const T=((P=i==null?void 0:i.images)==null?void 0:P.map(s=>({id:s.id,url:s.image_url||`/storage/${s.image}`,is_primary:s.is_primary,is_new:!1})))||[],[d,u]=m.useState(T),[y,A]=m.useState([]),[x,v]=m.useState(((F=(C=i==null?void 0:i.images)==null?void 0:C.find(s=>s.is_primary))==null?void 0:F.id)||null),[t,h]=m.useState({name:(i==null?void 0:i.name)||"",slug:(i==null?void 0:i.slug)||"",description:(i==null?void 0:i.description)||"",price:(i==null?void 0:i.price)||0,stock:(i==null?void 0:i.stock)||0,is_active:(i==null?void 0:i.is_active)??!0,sizes:((I=i==null?void 0:i.sizes)==null?void 0:I.map(s=>({id:s.id,size:s.size,stock:s.stock})))||[{size:"",stock:0}],deleted_image_ids:[],primary_image_id:x,new_images:[]}),[me,w]=m.useState({}),[oe,k]=m.useState(!1);m.useEffect(()=>{h(s=>({...s,deleted_image_ids:y}))},[y]),m.useEffect(()=>{h(s=>({...s,primary_image_id:x}))},[x]),m.useEffect(()=>{const s=d.filter(a=>a.is_new&&a.file).map(a=>a.file);h(a=>({...a,new_images:s}))},[d]);const U=[{title:"Dasbor",href:"/admin/dashboard"},{title:"Produk",href:"/admin/products"},{title:j?"Edit Produk":"Tambah Produk",href:j?`/admin/products/${i==null?void 0:i.id}/edit`:"/admin/products/create"}],G=s=>{const a=s.target.files;if(!a||a.length===0)return;const n=Array.from(a),l=[];n.forEach(r=>{const c=new FileReader;c.onload=$=>{var D;if((D=$.target)!=null&&D.result){const q={url:$.target.result,is_primary:d.length===0&&l.length===0,is_new:!0,file:r};u(X=>[...X,q])}},c.readAsDataURL(r)}),s.target.value=""},M=s=>{const a=d[s];a.id&&!a.is_new&&(A(n=>[...n,a.id]),x===a.id&&v(null)),u(n=>n.filter((l,r)=>r!==s))},B=s=>{const a=d[s];u(n=>n.map((l,r)=>({...l,is_primary:r===s}))),a.id&&!a.is_new?v(a.id):v(null)},H=()=>{if(typeof t.name=="string"){const s=t.name.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-");h(a=>({...a,slug:s}))}},R=()=>{h(s=>({...s,sizes:[...s.sizes,{size:"",stock:0}]}))},J=s=>{h(a=>({...a,sizes:a.sizes.filter((n,l)=>l!==s)}))},z=(s,a,n)=>{h(l=>{const r=[...l.sizes];return r[s]={...r[s],[a]:n},{...l,sizes:r}})},K=s=>{s.preventDefault(),k(!0);const a=new FormData;a.append("name",t.name),a.append("slug",t.slug),a.append("description",t.description),a.append("price",t.price.toString()),a.append("stock",t.stock.toString()),a.append("is_active",t.is_active?"1":"0"),t.sizes.forEach((r,c)=>{r.id&&a.append(`sizes[${c}][id]`,r.id.toString()),a.append(`sizes[${c}][size]`,r.size),a.append(`sizes[${c}][stock]`,r.stock.toString())}),y.forEach((r,c)=>{a.append(`deleted_image_ids[${c}]`,r.toString())}),x!==null&&a.append("primary_image_id",x.toString()),d.filter(r=>r.is_new&&r.file).map(r=>r.file).forEach((r,c)=>{a.append(`new_images[${c}]`,r)});const l={preserveScroll:!0,preserveState:!0,onSuccess:()=>{k(!1),w({})},onError:r=>{k(!1),w(r)}};j&&(i!=null&&i.id)?(a.append("_method","PUT"),E.post(`/admin/products/${i.id}`,a,l)):E.post("/admin/products",a,l)},f=(s,a)=>{h(n=>({...n,[s]:a}))};return e.jsxs(Z,{breadcrumbs:U,children:[e.jsx(O,{title:j?"Edit Produk":"Tambah Produk"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:j?"Edit Produk":"Tambah Produk"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{variant:"outline",asChild:!0,children:e.jsxs(Q,{href:"/admin/products",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Kembali ke Produk"]})}),e.jsxs(g,{type:"submit",form:"product-form",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Simpan Produk"]})]})]}),e.jsx(V,{}),e.jsxs("form",{id:"product-form",onSubmit:K,className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(_,{children:e.jsx(b,{children:"Informasi Dasar"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"Nama Produk"}),e.jsx("div",{className:"space-y-1",children:e.jsx(p,{id:"name",type:"text",value:t.name,onChange:s=>f("name",s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"slug",children:"Slug"}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{id:"slug",type:"text",value:t.slug,onChange:s=>f("slug",s.target.value)}),e.jsx(g,{type:"button",variant:"outline",onClick:H,children:"Generate"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"price",children:"Harga"}),e.jsx("div",{className:"space-y-1",children:e.jsx(p,{id:"price",type:"number",min:"0",value:t.price,onChange:s=>f("price",s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"stock",children:"Stok"}),e.jsx("div",{className:"space-y-1",children:e.jsx(p,{id:"stock",type:"number",min:"0",value:t.stock,onChange:s=>f("stock",s.target.value)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Deskripsi"}),e.jsx("div",{className:"space-y-1",children:e.jsx(Y,{id:"description",value:t.description,onChange:s=>f("description",s.target.value),rows:5})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"is_active",checked:t.is_active,onCheckedChange:s=>f("is_active",s)}),e.jsx(o,{htmlFor:"is_active",children:"Produk Aktif"})]})]})]}),e.jsxs(N,{children:[e.jsx(_,{children:e.jsx(b,{children:"Gambar Produk"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(o,{htmlFor:"images",className:"border-border hover:bg-muted flex h-32 w-full cursor-pointer flex-col items-center justify-center gap-1 rounded-lg border-2 border-dashed transition-colors",children:[e.jsx(ce,{className:"h-8 w-8"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Klik untuk mengunggah gambar"}),e.jsx("span",{className:"text-muted-foreground text-xs",children:"PNG, JPG atau JPEG (maks. 2MB)"})]}),e.jsx(p,{id:"images",type:"file",accept:"image/png,image/jpeg,image/jpg",multiple:!0,className:"hidden",onChange:G})]}),d.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4",children:d.map((s,a)=>e.jsxs("div",{className:`group relative aspect-square overflow-hidden rounded-lg border ${s.is_primary?"ring-primary ring-2":""}`,children:[e.jsx("img",{src:s.url,alt:"",className:"h-full w-full object-cover"}),e.jsxs("div",{className:"bg-background/80 absolute inset-0 flex items-center justify-center gap-2 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx(g,{type:"button",variant:"secondary",size:"icon",onClick:()=>B(a),disabled:s.is_primary,children:e.jsx(ne,{className:s.is_primary?"fill-primary":""})}),e.jsx(g,{type:"button",variant:"destructive",size:"icon",onClick:()=>M(a),children:e.jsx(ae,{className:"h-4 w-4"})})]})]},a))})]})]}),e.jsxs(N,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(b,{children:"Ukuran yang Tersedia"}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:R,children:[e.jsx(ie,{className:"mr-1 h-4 w-4"}),"Tambah Ukuran"]})]}),e.jsx(S,{className:"space-y-4",children:t.sizes.map((s,a)=>e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(o,{htmlFor:`size-${a}`,children:"Ukuran"}),e.jsx(p,{id:`size-${a}`,type:"text",value:s.size,onChange:n=>z(a,"size",n.target.value)})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(o,{htmlFor:`stock-${a}`,children:"Stok"}),e.jsx(p,{id:`stock-${a}`,type:"number",min:"0",value:s.stock,onChange:n=>z(a,"stock",n.target.value)})]}),e.jsx(g,{type:"button",variant:"outline",size:"icon",onClick:()=>J(a),disabled:t.sizes.length===1,children:e.jsx(re,{className:"h-4 w-4"})})]},a))})]})]})]})]})}export{$e as default};
