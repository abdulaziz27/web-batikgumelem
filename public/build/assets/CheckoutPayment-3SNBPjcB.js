import{r,u as P,S as o,j as e,L as E}from"./app-C2CPBORD.js";import{L as j}from"./Layout-C5gfhG3T.js";import{B as u}from"./index-DXA0Juze.js";import{C as k,a as y,b,e as v,c as w,d as C}from"./card-0wfsc4SL.js";import{f as _}from"./formatters-BdPsR_AQ.js";import{C as L}from"./credit-card-C5sYi2l0.js";import{L as $}from"./loader-circle-DKmdoE_R.js";/* empty css            */import"./use-initials-BkezIM7N.js";import"./Combination-Dj-ZwytL.js";import"./map-pin-B6NwVNmx.js";import"./badge-Cw30zDw6.js";const z=({order:a,payment_url:t,midtrans_client_key:h,is_production:x})=>{const[f,d]=r.useState(!1),[n,S]=r.useState(""),[c,p]=r.useState(null);let g=()=>{};try{g=P().clearCart}catch{console.warn("Cart provider not available, using fallback")}if(r.useEffect(()=>{if(!a||!a.id){p("Data pesanan tidak valid"),console.error("Invalid order data:",a);return}!a.payment_token&&!a.payment_url&&console.warn("Payment token/URL missing - this means the payment wasn't properly initialized")},[a]),r.useEffect(()=>{if(c)return;let s="";if(a!=null&&a.payment_token)s=a.payment_token;else if(t&&t!=="null"){const m=t.match(/([^\/]+)$/);m&&m[1]&&(s=m[1])}S(s)},[a,t,c]),r.useEffect(()=>{if(c||!n)return;const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const m=x?"https://app.midtrans.com/snap/snap.js":"https://app.sandbox.midtrans.com/snap/snap.js",l=document.createElement("script");return l.id="midtrans-script",l.src=m,l.setAttribute("data-client-key",h),l.async=!0,l.onload=()=>{console.log("Snap.js loaded successfully"),window.snap&&n&&window.snap.pay(n,{onSuccess:function(i){console.log("Payment success:",i),o.visit(`/checkout/success?order_id=${a.order_number}`)},onPending:function(i){console.log("Payment pending:",i),o.visit(`/checkout/pending?order_id=${a.order_number}`)},onError:function(i){console.error("Payment error:",i),o.visit(`/checkout/failed?order_id=${a.order_number}`)},onClose:function(){console.log("Payment widget closed"),o.visit(`/checkout/cancel?order_id=${a.order_number}`)}})},l.onerror=()=>{console.error("Failed to load Snap.js"),p("Gagal memuat payment processor")},document.body.appendChild(l),()=>{const i=document.getElementById("midtrans-script");i&&document.body.removeChild(i)}},[n,c,x,h,a]),r.useEffect(()=>{try{g()}catch(s){console.warn("Error clearing cart:",s)}},[]),r.useEffect(()=>{console.log("Order data:",a),console.log("Payment URL:",t),console.log("Payment token:",a==null?void 0:a.payment_token)},[a,t]),c)return e.jsx(j,{children:e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"mx-auto max-w-3xl",children:e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsx(b,{className:"text-red-600",children:"Terjadi Kesalahan"}),e.jsx(v,{children:"Tidak dapat memproses pembayaran saat ini"})]}),e.jsxs(w,{children:[e.jsx("p",{className:"text-gray-700",children:c}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Silakan coba lagi atau hubungi customer service kami"})]}),e.jsx(C,{children:e.jsx(u,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})})})});const N=()=>{c||(d(!0),window.snap&&n?(console.log("Opening Snap payment modal with token:",n),window.snap.pay(n,{onSuccess:s=>{console.log("Payment success:",s),o.visit(`/checkout/success?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onPending:s=>{console.log("Payment pending:",s),o.visit(`/checkout/pending?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onError:s=>{console.error("Payment error:",s),o.visit(`/checkout/failed?order_id=${a.id}&error_message=${encodeURIComponent(s.message||"")}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onClose:()=>{console.log("Payment widget closed without completion"),d(!1),window.location.pathname.includes("/checkout/success")||o.visit(`/checkout/pending?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})}})):(console.error("Snap.js not loaded or token not available"),t&&t!=="null"?window.location.href=t:(p("Gateway pembayaran tidak tersedia"),d(!1))))};return e.jsxs(j,{children:[e.jsx(E,{title:"Pembayaran"}),e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(L,{className:"mr-2 h-5 w-5"}),"Selesaikan Pembayaran"]}),e.jsx(v,{children:"Pesanan Anda telah dibuat. Silakan selesaikan pembayaran untuk memproses pesanan Anda."})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("p",{className:"font-medium",children:"Detail Pesanan"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Nomor Pesanan: ",a==null?void 0:a.order_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ",_((a==null?void 0:a.total_amount)||0)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Metode Pembayaran: ",(a==null?void 0:a.payment_method)==="bank_transfer"?"Transfer Bank":"E-Wallet"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("p",{className:"mb-4 text-center",children:"Klik tombol di bawah untuk melanjutkan ke halaman pembayaran"}),e.jsx(u,{onClick:N,className:"bg-batik-indigo hover:bg-batik-indigo/90",disabled:f||!n,children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})]})]}),e.jsx(C,{children:e.jsx(u,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})]})})]})};export{z as default};
