import{r as i,u as f,j as e,S as c}from"./app-C8Sg5s2D.js";import{L as g}from"./Layout-DUeHlWHd.js";import{B as p}from"./index-C-S3fGAe.js";import{C as j,a as k,b,e as y,c as C,d as N}from"./card-CopSugPh.js";import{f as w}from"./formatters-BdPsR_AQ.js";import{C as S}from"./credit-card-D7pfOsAo.js";import{L as P}from"./loader-circle-C6lYJXhs.js";/* empty css            */import"./use-initials-DV9zzRH8.js";import"./map-pin-BkobWDjU.js";import"./badge-sxevUz_k.js";const F=({order:s,payment_url:n})=>{const[l,d]=i.useState(!1),[r,x]=i.useState(""),{clearCart:u}=f();i.useEffect(()=>{let a="";if(s.payment_token)a=s.payment_token;else if(n){const o=n.match(/([^\/]+)$/);o&&o[1]&&(a=o[1])}x(a),console.log("Payment token:",a),console.log("Payment URL:",n)},[s,n]),i.useEffect(()=>{const a=document.getElementById("midtrans-script");a&&document.body.removeChild(a);const o="https://app.sandbox.midtrans.com/snap/snap.js",t=document.createElement("script");return t.id="midtrans-script",t.src=o,t.setAttribute("data-client-key","SB-Mid-client-xo3JszBk1gen0AEn"),t.onload=()=>{console.log("Snap.js loaded successfully")},t.onerror=()=>{console.error("Failed to load Snap.js")},document.body.appendChild(t),()=>{const m=document.getElementById("midtrans-script");m&&document.body.removeChild(m)}},[]),i.useEffect(()=>{u(),localStorage.removeItem("cart")},[]);const h=()=>{d(!0),console.log("Pay Now clicked, snap object:",window.snap),window.snap&&r?(console.log("Opening Snap payment modal with token:",r),window.snap.pay(r,{onSuccess:function(a){console.log("Payment success:",a),c.visit(`/checkout/success?order_id=${s.id}`)},onPending:function(a){console.log("Payment pending:",a),c.visit(`/checkout/success?order_id=${s.id}`)},onError:function(a){console.error("Payment error:",a),c.visit(`/checkout/cancel?order_id=${s.id}`)},onClose:function(){console.log("Payment widget closed"),d(!1)}})):(console.error("Snap.js not loaded or token not available"),window.location.href=n)};return e.jsx(g,{children:e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),e.jsxs(j,{children:[e.jsxs(k,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(S,{className:"mr-2 h-5 w-5"}),"Selesaikan Pembayaran"]}),e.jsx(y,{children:"Pesanan Anda telah dibuat. Silakan selesaikan pembayaran untuk memproses pesanan Anda."})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("p",{className:"font-medium",children:"Detail Pesanan"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Nomor Pesanan: ",s.order_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ",w(s.total_amount)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Metode Pembayaran: ",s.payment_method==="bank_transfer"?"Transfer Bank":"E-Wallet"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("p",{className:"mb-4 text-center",children:"Klik tombol di bawah untuk melanjutkan ke halaman pembayaran"}),e.jsx(p,{onClick:h,className:"bg-batik-indigo hover:bg-batik-indigo/90",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})]})]}),e.jsx(N,{children:e.jsx(p,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})]})})})};export{F as default};
