import{r as n,u as P,j as e,L as E,S as o}from"./app-gVp8T97W.js";import{L as g}from"./Layout-CvxS8uqn.js";import{B as p}from"./index-LawfOneF.js";import{C as k,a as y,b,e as v,c as C,d as N}from"./card-M7fCHlBc.js";import{f as L}from"./formatters-BdPsR_AQ.js";import{C as B}from"./credit-card-BvmxhNQ8.js";import{L as T}from"./loader-circle-Coclx5xD.js";/* empty css            */import"./use-initials-D-ET1N7w.js";import"./Combination-CeemgJ7w.js";import"./map-pin-De9-IGzt.js";import"./badge-ReQ3c7EH.js";const z=({order:a,payment_url:t,midtrans_client_key:u,is_production:x})=>{const[h,m]=n.useState(!1),[r,S]=n.useState(""),[i,d]=n.useState(null);let f=()=>{};try{f=P().clearCart}catch{console.warn("Cart provider not available, using fallback")}if(n.useEffect(()=>{if(!a||!a.id){d("Data pesanan tidak valid"),console.error("Invalid order data:",a);return}!a.payment_token&&!a.payment_url&&console.warn("Payment token/URL missing - this means the payment wasn't properly initialized")},[a]),n.useEffect(()=>{if(i)return;let s="";if(a!=null&&a.payment_token)s=a.payment_token;else if(t&&t!=="null"){const c=t.match(/([^\/]+)$/);c&&c[1]&&(s=c[1])}S(s)},[a,t,i]),n.useEffect(()=>{if(i||!r)return;const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const c=x?"https://app.midtrans.com/snap/snap.js":"https://app.sandbox.midtrans.com/snap/snap.js",l=document.createElement("script");return l.id="midtrans-script",l.src=c,l.setAttribute("data-client-key",u),l.onload=()=>console.log("Snap.js loaded successfully"),l.onerror=()=>d("Gagal memuat payment processor"),document.body.appendChild(l),()=>{const j=document.getElementById("midtrans-script");j&&document.body.removeChild(j)}},[r,i,x,u]),n.useEffect(()=>{try{f()}catch(s){console.warn("Error clearing cart:",s)}},[]),n.useEffect(()=>{console.log("Order data:",a),console.log("Payment URL:",t),console.log("Payment token:",a==null?void 0:a.payment_token)},[a,t]),i)return e.jsx(g,{children:e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"mx-auto max-w-3xl",children:e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsx(b,{className:"text-red-600",children:"Terjadi Kesalahan"}),e.jsx(v,{children:"Tidak dapat memproses pembayaran saat ini"})]}),e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-700",children:i}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Silakan coba lagi atau hubungi customer service kami"})]}),e.jsx(N,{children:e.jsx(p,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})})})});const w=()=>{i||(m(!0),window.snap&&r?(console.log("Opening Snap payment modal with token:",r),window.snap.pay(r,{onSuccess:s=>{console.log("Payment success:",s),o.visit(`/checkout/success?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onPending:s=>{console.log("Payment pending:",s),o.visit(`/checkout/pending?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onError:s=>{console.error("Payment error:",s),o.visit(`/checkout/failed?order_id=${a.id}&error_message=${encodeURIComponent(s.message||"")}`,{preserveState:!0,preserveScroll:!0,replace:!0})},onClose:()=>{console.log("Payment widget closed without completion"),m(!1),window.location.pathname.includes("/checkout/success")||o.visit(`/checkout/pending?order_id=${a.id}`,{preserveState:!0,preserveScroll:!0,replace:!0})}})):(console.error("Snap.js not loaded or token not available"),t&&t!=="null"?window.location.href=t:(d("Gateway pembayaran tidak tersedia"),m(!1))))};return e.jsxs(g,{children:[e.jsx(E,{title:"Pembayaran"}),e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Selesaikan Pembayaran"]}),e.jsx(v,{children:"Pesanan Anda telah dibuat. Silakan selesaikan pembayaran untuk memproses pesanan Anda."})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("p",{className:"font-medium",children:"Detail Pesanan"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Nomor Pesanan: ",a==null?void 0:a.order_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ",L((a==null?void 0:a.total_amount)||0)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Metode Pembayaran: ",(a==null?void 0:a.payment_method)==="bank_transfer"?"Transfer Bank":"E-Wallet"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("p",{className:"mb-4 text-center",children:"Klik tombol di bawah untuk melanjutkan ke halaman pembayaran"}),e.jsx(p,{onClick:w,className:"bg-batik-indigo hover:bg-batik-indigo/90",disabled:h||!r,children:h?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})]})]}),e.jsx(N,{children:e.jsx(p,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})]})})]})};export{z as default};
