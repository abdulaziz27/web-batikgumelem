import{K as N,r as o,j as e,L as v,$ as i,S as w}from"./app-BXt1EXhE.js";import{B as l}from"./index-CYkK3APA.js";import{C,a as S,b as k,c as P}from"./card-BPxOS1W-.js";import{A as L}from"./app-layout-BWLpxr4S.js";import{f as _}from"./formatters-BdPsR_AQ.js";import{L as E}from"./loader-circle-dLsDnjGP.js";import{C as B}from"./credit-card-BiSmmmv4.js";import{C as u}from"./chevron-left-BjDAJ8QW.js";import{C as p,X as D}from"./use-initials-4Cu_RISo.js";import{C as h}from"./clock-C9NBgcRq.js";import{C as $}from"./Combination-l0fbbUhy.js";import{S as T}from"./shopping-bag-DDzNUESt.js";import{P as A}from"./package-DLSA3Cxw.js";/* empty css            */import"./app-sidebar-header-CxhEH_Nu.js";import"./app-logo-icon-CIOCRvVq.js";import"./breadcrumb-CQM-6EPa.js";import"./separator-xWZELdkL.js";import"./index-D2yaAqYb.js";import"./map-pin-DI7eILU-.js";const M=[{title:"Dashboard",href:"/dashboard"},{title:"Pesanan Saya",href:"/orders"}];function ne({orders:c}){const{auth:R}=N().props,[x,f]=o.useState({}),[d,r]=o.useState(null);o.useEffect(()=>{const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const t="https://app.sandbox.midtrans.com/snap/snap.js",a=document.createElement("script");return a.id="midtrans-script",a.src=t,a.setAttribute("data-client-key","SB-Mid-client-xo3JszBk1gen0AEn"),a.onload=()=>{console.log("Snap.js loaded successfully")},a.onerror=()=>{console.error("Failed to load Snap.js")},document.body.appendChild(a),()=>{const n=document.getElementById("midtrans-script");n&&document.body.removeChild(n)}},[]),o.useEffect(()=>{const s={};c.data.forEach(t=>{if(t.payment_url)try{const a=JSON.parse(t.payment_url);if(a.token)s[t.id]=a.token;else{const n=t.payment_url.match(/([^\/]+)$/);n&&n[1]&&(s[t.id]=n[1])}}catch{const n=t.payment_url.match(/([^\/]+)$/);n&&n[1]&&(s[t.id]=n[1])}}),f(s)},[c.data]);const j=s=>{const t=x[s];if(t)if(r(s),window.snap&&t)window.snap.pay(t,{onSuccess:function(a){console.log("Payment success:",a),setTimeout(()=>{m(s)},1500)},onPending:function(a){console.log("Payment pending:",a),setTimeout(()=>{m(s)},1500)},onError:function(a){console.error("Payment error:",a),r(null)},onClose:function(){console.log("Payment widget closed"),r(null)}});else{console.error("Snap.js not loaded or token not available");const a=c.data.find(n=>n.id===s);a!=null&&a.payment_url&&(window.location.href=a.payment_url),r(null)}},m=s=>{fetch(`/checkout/check-status/${s}`).then(t=>{t.ok?window.location.reload():(console.error("Failed to check payment status"),r(null))}).catch(t=>{console.error("Error checking payment status:",t),r(null)})},g=s=>{const t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(s).toLocaleDateString("id-ID",t)},y=s=>{switch(s.toLowerCase()){case"pending":return"text-orange-500 bg-orange-50";case"processing":return"text-blue-500 bg-blue-50";case"shipped":return"text-purple-500 bg-purple-50";case"completed":return"text-green-500 bg-green-50";case"cancelled":return"text-red-500 bg-red-50";default:return"text-gray-500 bg-gray-50"}},b=s=>{switch(s.toLowerCase()){case"pending":return e.jsx(h,{className:"h-4 w-4"});case"processing":return e.jsx(A,{className:"h-4 w-4"});case"shipped":return e.jsx(T,{className:"h-4 w-4"});case"completed":return e.jsx($,{className:"h-4 w-4"});case"cancelled":return e.jsx(D,{className:"h-4 w-4"});default:return e.jsx(h,{className:"h-4 w-4"})}};return e.jsxs(L,{breadcrumbs:M,children:[e.jsx(v,{title:"Pesanan Saya"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Pesanan Saya"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(l,{asChild:!0,variant:"outline",children:e.jsx(i,{href:"/dashboard",children:"Kembali ke Dashboard"})})})]}),e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(k,{children:"Riwayat Pesanan"})}),e.jsx(P,{children:c.data.length>0?e.jsxs("div",{className:"space-y-6",children:[c.data.map(s=>e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex flex-col space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:["Pesanan #",s.order_number]}),e.jsx("div",{className:"text-muted-foreground text-sm",children:g(s.created_at)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:`inline-flex items-center space-x-1 rounded-full px-2 py-1 text-xs ${y(s.status)}`,children:[b(s.status),e.jsx("span",{children:s.status})]}),e.jsxs("div",{className:"text-muted-foreground text-sm",children:[s.items.length," item"]})]})]}),e.jsxs("div",{className:"flex flex-col items-start space-y-2 md:items-end",children:[e.jsx("div",{className:"font-semibold",children:_(s.total_amount)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(i,{href:`/orders/${s.id}`,children:"Lihat Detail"})}),s.payment_status!=="paid"&&s.payment_url&&s.status!=="cancelled"&&e.jsx(l,{onClick:()=>j(s.id),size:"sm",className:"bg-green-600 hover:bg-green-700",disabled:d===s.id,children:d===s.id?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-1 h-3 w-3 animate-spin"}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-1 h-3 w-3"}),"Bayar"]})}),(s.status==="pending"||s.status==="processing")&&e.jsx(i,{href:`/orders/${s.id}/cancel`,method:"put",as:"button",className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 inline-flex h-8 items-center justify-center rounded-md px-3 py-1 text-xs font-medium shadow",onSuccess:()=>{w.reload()},children:"Batalkan"})]})]})]})},s.id)),c.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between border-t pt-4",children:[e.jsxs("div",{className:"text-muted-foreground text-sm",children:["Menampilkan ",c.from,"-",c.to," dari ",c.total," pesanan"]}),e.jsx("div",{className:"flex items-center space-x-2",children:c.links.map((s,t)=>e.jsx(l,{asChild:!!s.url,variant:s.active?"default":"outline",size:"sm",disabled:!s.url,children:s.url?e.jsx(i,{href:s.url,children:s.label==="&laquo; Previous"?e.jsx(u,{className:"h-4 w-4"}):s.label==="Next &raquo;"?e.jsx(p,{className:"h-4 w-4"}):s.label}):e.jsx("span",{children:s.label==="&laquo; Previous"?e.jsx(u,{className:"h-4 w-4"}):s.label==="Next &raquo;"?e.jsx(p,{className:"h-4 w-4"}):s.label})},t))})]})]}):e.jsx("div",{className:"flex h-[300px] items-center justify-center rounded-lg border border-dashed",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Belum ada pesanan"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Anda belum melakukan pemesanan produk"}),e.jsx(l,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(i,{href:"/products",children:"Lihat Produk"})})]})})})]})]})]})}export{ne as default};
