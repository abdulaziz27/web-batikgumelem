import{r as n,u as w,j as a,S as d}from"./app-CYDLR7DQ.js";import{L as f}from"./Layout-DdMIqMtu.js";import{B as x}from"./index-C6SDhB8v.js";import{C as j,a as g,b as k,e as y,c as b,d as N}from"./card-NVK-lCst.js";import{f as P}from"./formatters-BdPsR_AQ.js";import{C as S}from"./credit-card-YiGZDpad.js";import{L as E}from"./loader-circle-B7Jt2E1p.js";/* empty css            */import"./use-initials-BU6pEj1R.js";import"./Combination-Dbugd-ik.js";import"./map-pin-KJthWoVX.js";import"./badge-EF9Vn1HI.js";const z=({order:e,payment_url:t})=>{const[p,r]=n.useState(!1),[l,v]=n.useState(""),[i,m]=n.useState(null);let h=()=>{};try{h=w().clearCart}catch{console.warn("Cart provider not available, using fallback")}n.useEffect(()=>{if(!e||!e.id){m("Data pesanan tidak valid"),console.error("Invalid order data:",e);return}!e.payment_token&&!e.payment_url&&console.warn("Payment token/URL missing - this means the payment wasn't properly initialized")},[e]),n.useEffect(()=>{if(i)return;let s="";if(e!=null&&e.payment_token)s=e.payment_token;else if(t&&t!=="null"){const o=t.match(/([^\/]+)$/);o&&o[1]&&(s=o[1])}v(s),console.log("Payment token:",s||"No token available"),console.log("Payment URL:",t||"No URL available")},[e,t,i]),n.useEffect(()=>{if(i||!l)return;const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const o="https://app.sandbox.midtrans.com/snap/snap.js",c=document.createElement("script");return c.id="midtrans-script",c.src=o,c.setAttribute("data-client-key","SB-Mid-client-xo3JszBk1gen0AEn"),c.onload=()=>console.log("Snap.js loaded successfully"),c.onerror=()=>m("Gagal memuat payment processor"),document.body.appendChild(c),()=>{const u=document.getElementById("midtrans-script");u&&document.body.removeChild(u)}},[l,i]),n.useEffect(()=>{try{h()}catch(s){console.warn("Error clearing cart:",s)}},[]),n.useEffect(()=>{console.log("Order data:",e),console.log("Payment URL:",t),console.log("Payment token:",e==null?void 0:e.payment_token)},[e,t]);const C=()=>{i||(r(!0),window.snap&&l?(console.log("Opening Snap payment modal with token:",l),window.snap.pay(l,{onSuccess:s=>{console.log("Payment success:",s),d.visit(`/checkout/success?order_id=${e.id}`)},onPending:s=>{console.log("Payment pending:",s),d.visit(`/checkout/success?order_id=${e.id}`)},onError:s=>{console.error("Payment error:",s),d.visit(`/checkout/cancel?order_id=${e.id}`)},onClose:()=>{console.log("Payment widget closed"),r(!1)}})):(console.error("Snap.js not loaded or token not available"),t&&t!=="null"?window.location.href=t:(m("Gateway pembayaran tidak tersedia"),r(!1))))};return i?a.jsx(f,{children:a.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:a.jsx("div",{className:"mx-auto max-w-3xl",children:a.jsxs(j,{children:[a.jsxs(g,{children:[a.jsx(k,{className:"text-red-600",children:"Terjadi Kesalahan"}),a.jsx(y,{children:"Tidak dapat memproses pembayaran saat ini"})]}),a.jsxs(b,{children:[a.jsx("p",{className:"text-gray-700",children:i}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Silakan coba lagi atau hubungi customer service kami"})]}),a.jsx(N,{children:a.jsx(x,{variant:"outline",asChild:!0,className:"mr-auto",children:a.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})})})}):a.jsx(f,{children:a.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"mx-auto max-w-3xl",children:[a.jsx("div",{className:"mb-8",children:a.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),a.jsxs(j,{children:[a.jsxs(g,{children:[a.jsxs(k,{className:"flex items-center",children:[a.jsx(S,{className:"mr-2 h-5 w-5"}),"Selesaikan Pembayaran"]}),a.jsx(y,{children:"Pesanan Anda telah dibuat. Silakan selesaikan pembayaran untuk memproses pesanan Anda."})]}),a.jsxs(b,{children:[a.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[a.jsx("p",{className:"font-medium",children:"Detail Pesanan"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Nomor Pesanan: ",e==null?void 0:e.order_number]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ",P((e==null?void 0:e.total_amount)||0)]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Metode Pembayaran: ",(e==null?void 0:e.payment_method)==="bank_transfer"?"Transfer Bank":"E-Wallet"]})]}),a.jsxs("div",{className:"flex flex-col items-center justify-center",children:[a.jsx("p",{className:"mb-4 text-center",children:"Klik tombol di bawah untuk melanjutkan ke halaman pembayaran"}),a.jsx(x,{onClick:C,className:"bg-batik-indigo hover:bg-batik-indigo/90",disabled:p||!l,children:p?a.jsxs(a.Fragment,{children:[a.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})]})]}),a.jsx(N,{children:a.jsx(x,{variant:"outline",asChild:!0,className:"mr-auto",children:a.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})]})})})};export{z as default};
