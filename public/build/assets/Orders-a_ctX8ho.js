import{K as C,r as o,j as e,L as S,$ as i,S as k}from"./app-C2CPBORD.js";import{B as l}from"./index-DXA0Juze.js";import{C as P,a as L,b as D,c as E}from"./card-0wfsc4SL.js";import{A as _}from"./app-layout-h0fHC5bg.js";import{f as B}from"./formatters-BdPsR_AQ.js";import{L as $}from"./loader-circle-DKmdoE_R.js";import{C as T}from"./credit-card-C5sYi2l0.js";import{C as h}from"./chevron-left-wabgBPRf.js";import{C as x,X as M}from"./use-initials-BkezIM7N.js";import{C as f}from"./clock-D905DNSU.js";import{C as R}from"./Combination-Dj-ZwytL.js";import{S as q}from"./shopping-bag-BClCA3J5.js";import{P as A}from"./package-B0MEwj-v.js";/* empty css            */import"./app-sidebar-header-1Nh8Sx-d.js";import"./app-logo-icon-qiwcTHFe.js";import"./breadcrumb-uKX-wEX0.js";import"./separator-CBjwEi6j.js";import"./index-CV1LDB82.js";import"./map-pin-B6NwVNmx.js";const F=[{title:"Dashboard",href:"/dashboard"},{title:"Pesanan Saya",href:"/orders"}];function ie({orders:r,midtrans_client_key:d,is_production:m}){const{auth:O}=C().props,[g,j]=o.useState({}),[u,c]=o.useState(null);o.useEffect(()=>{const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const t=m?"https://app.midtrans.com/snap/snap.js":"https://app.sandbox.midtrans.com/snap/snap.js",a=document.createElement("script");return a.id="midtrans-script",a.src=t,a.setAttribute("data-client-key",d),a.onload=()=>{console.log("Snap.js loaded successfully")},a.onerror=()=>{console.error("Failed to load Snap.js")},document.body.appendChild(a),()=>{const n=document.getElementById("midtrans-script");n&&document.body.removeChild(n)}},[m,d]),o.useEffect(()=>{const s={};r.data.forEach(t=>{if(t.payment_url)try{const a=JSON.parse(t.payment_url);if(a.token)s[t.id]=a.token;else{const n=t.payment_url.match(/([^\/]+)$/);n&&n[1]&&(s[t.id]=n[1])}}catch{const n=t.payment_url.match(/([^\/]+)$/);n&&n[1]&&(s[t.id]=n[1])}}),j(s)},[r.data]);const y=s=>{const t=g[s];if(t)if(c(s),window.snap&&t)window.snap.pay(t,{onSuccess:function(a){console.log("Payment success:",a),setTimeout(()=>{p(s)},1500)},onPending:function(a){console.log("Payment pending:",a),setTimeout(()=>{p(s)},1500)},onError:function(a){console.error("Payment error:",a),c(null)},onClose:function(){console.log("Payment widget closed"),c(null)}});else{console.error("Snap.js not loaded or token not available");const a=r.data.find(n=>n.id===s);a!=null&&a.payment_url&&(window.location.href=a.payment_url),c(null)}},p=s=>{fetch(`/checkout/check-status/${s}`).then(t=>{t.ok?window.location.reload():(console.error("Failed to check payment status"),c(null))}).catch(t=>{console.error("Error checking payment status:",t),c(null)})},b=s=>{const t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(s).toLocaleDateString("id-ID",t)},N=s=>{switch(s.toLowerCase()){case"pending":return"text-orange-500 bg-orange-50";case"processing":return"text-blue-500 bg-blue-50";case"shipped":return"text-purple-500 bg-purple-50";case"completed":return"text-green-500 bg-green-50";case"cancelled":return"text-red-500 bg-red-50";default:return"text-gray-500 bg-gray-50"}},v=s=>{switch(s.toLowerCase()){case"pending":return e.jsx(f,{className:"h-4 w-4"});case"processing":return e.jsx(A,{className:"h-4 w-4"});case"shipped":return e.jsx(q,{className:"h-4 w-4"});case"completed":return e.jsx(R,{className:"h-4 w-4"});case"cancelled":return e.jsx(M,{className:"h-4 w-4"});default:return e.jsx(f,{className:"h-4 w-4"})}},w=s=>{switch(s.toLowerCase()){case"pending":return"Menunggu";case"processing":return"Diproses";case"shipped":return"Dikirim";case"completed":return"Selesai";case"cancelled":return"Dibatalkan";default:return s}};return e.jsxs(_,{breadcrumbs:F,children:[e.jsx(S,{title:"Pesanan Saya"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Pesanan Saya"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(l,{asChild:!0,variant:"outline",children:e.jsx(i,{href:"/dashboard",children:"Kembali ke Dashboard"})})})]}),e.jsxs(P,{children:[e.jsx(L,{children:e.jsx(D,{children:"Riwayat Pesanan"})}),e.jsx(E,{children:r.data.length>0?e.jsxs("div",{className:"space-y-6",children:[r.data.map(s=>e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex flex-col space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:["Pesanan #",s.order_number]}),e.jsx("div",{className:"text-muted-foreground text-sm",children:b(s.created_at)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:`inline-flex items-center space-x-1 rounded-full px-2 py-1 text-xs ${N(s.status)}`,children:[v(s.status),e.jsx("span",{children:w(s.status)})]}),e.jsxs("div",{className:"text-muted-foreground text-sm",children:[s.items.length," item"]})]})]}),e.jsxs("div",{className:"flex flex-col items-start space-y-2 md:items-end",children:[e.jsx("div",{className:"font-semibold",children:B(s.total_amount)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(i,{href:`/orders/${s.id}`,children:"Lihat Detail"})}),s.payment_status!=="paid"&&s.payment_url&&s.status!=="cancelled"&&e.jsx(l,{onClick:()=>y(s.id),size:"sm",className:"bg-green-600 hover:bg-green-700",disabled:u===s.id,children:u===s.id?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Bayar Sekarang"]})}),s.status==="pending"&&s.payment_status!=="paid"&&e.jsx(i,{href:`/orders/${s.id}/cancel`,method:"put",as:"button",className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 inline-flex h-8 items-center justify-center rounded-md px-3 py-1 text-xs font-medium shadow",onSuccess:()=>{k.reload()},children:"Batalkan"})]})]})]})},s.id)),r.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between border-t pt-4",children:[e.jsxs("div",{className:"text-muted-foreground text-sm",children:["Menampilkan ",r.from,"-",r.to," dari ",r.total," pesanan"]}),e.jsx("div",{className:"flex items-center space-x-2",children:r.links.map((s,t)=>e.jsx(l,{asChild:!!s.url,variant:s.active?"default":"outline",size:"sm",disabled:!s.url,children:s.url?e.jsx(i,{href:s.url,children:s.label==="&laquo; Previous"?e.jsx(h,{className:"h-4 w-4"}):s.label==="Next &raquo;"?e.jsx(x,{className:"h-4 w-4"}):s.label}):e.jsx("span",{children:s.label==="&laquo; Previous"?e.jsx(h,{className:"h-4 w-4"}):s.label==="Next &raquo;"?e.jsx(x,{className:"h-4 w-4"}):s.label})},t))})]})]}):e.jsx("div",{className:"flex h-[300px] items-center justify-center rounded-lg border border-dashed",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Belum ada pesanan"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Anda belum melakukan pemesanan produk"}),e.jsx(l,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(i,{href:"/products",children:"Lihat Produk"})})]})})})]})]})]})}export{ie as default};
