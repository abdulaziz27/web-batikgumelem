import{r as n,u as S,j as e,L as E,S as d}from"./app-B_f-cd7J.js";import{L as j}from"./Layout-DeEvr1HL.js";import{B as y}from"./index-1eqII87F.js";import{C as g,a as b,b as k,e as v,c as C,d as N}from"./card-DSk2bZI7.js";import{f as L}from"./formatters-BdPsR_AQ.js";import{L as T}from"./loader-circle-CZMarkZR.js";import{C as $}from"./credit-card-CGJkvoyU.js";/* empty css            */import"./use-initials-Bs9_kafW.js";import"./Combination-BNqu6t5U.js";import"./map-pin-30nRegbA.js";import"./badge-BZeRkEtD.js";const G=({order:s,payment_url:i,midtrans_client_key:m,is_production:p})=>{const[x,h]=n.useState(!1),[o,w]=n.useState(""),[t,l]=n.useState(null);let u=()=>{};try{u=S().clearCart}catch{console.warn("Cart provider not available, using fallback")}if(n.useEffect(()=>{if(!s||!s.id){l("Data pesanan tidak valid"),console.error("Invalid order data:",s);return}!s.payment_token&&!s.payment_url&&console.warn("Payment token/URL missing - this means the payment wasn't properly initialized")},[s]),n.useEffect(()=>{if(t)return;let a="";if(s!=null&&s.payment_token)a=s.payment_token;else if(i&&i!=="null"){const c=i.match(/([^\/]+)$/);c&&c[1]&&(a=c[1])}w(a)},[s,i,t]),n.useEffect(()=>{if(t||!o)return;const a=document.getElementById("midtrans-script");a&&document.body.removeChild(a);const c=p?"https://app.midtrans.com/snap/snap.js":"https://app.sandbox.midtrans.com/snap/snap.js",r=document.createElement("script");return r.id="midtrans-script",r.src=c,r.setAttribute("data-client-key",m),r.onload=()=>console.log("Snap.js loaded successfully"),r.onerror=()=>l("Gagal memuat payment processor"),document.body.appendChild(r),()=>{const f=document.getElementById("midtrans-script");f&&document.body.removeChild(f)}},[o,t,p,m]),n.useEffect(()=>{try{u()}catch(a){console.warn("Error clearing cart:",a)}},[]),n.useEffect(()=>{console.log("Order data:",s),console.log("Payment URL:",i),console.log("Payment token:",s==null?void 0:s.payment_token)},[s,i]),t)return e.jsx(j,{children:e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"mx-auto max-w-3xl",children:e.jsxs(g,{children:[e.jsxs(b,{children:[e.jsx(k,{className:"text-red-600",children:"Terjadi Kesalahan"}),e.jsx(v,{children:"Tidak dapat memproses pembayaran saat ini"})]}),e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-700",children:t}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Silakan coba lagi atau hubungi customer service kami"})]}),e.jsx(N,{children:e.jsx(y,{variant:"outline",asChild:!0,className:"mr-auto",children:e.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})})})});const P=()=>{if(!o){l("Token pembayaran tidak valid");return}h(!0),window.snap?window.snap.pay(o,{onSuccess:function(a){console.log("Payment success:",a),d.visit(`/checkout/success?order_id=${a.order_id}`)},onPending:function(a){console.log("Payment pending:",a),d.visit(`/checkout/pending?order_id=${a.order_id}`)},onError:function(a){console.error("Payment error:",a),d.visit(`/checkout/failed?order_id=${a.order_id}`)},onClose:function(){console.log("Payment widget closed without completion");const a=`ORD-${s.id}-${Math.floor(Date.now()/1e3)}`;d.visit(`/checkout/pending?order_id=${a}`,{preserveState:!0,preserveScroll:!0})}}):(l("Payment gateway not initialized"),h(!1))};return e.jsxs(j,{children:[e.jsx(E,{title:"Pembayaran"}),e.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),e.jsxs(g,{children:[e.jsxs(b,{children:[e.jsx(k,{children:"Detail Pembayaran"}),e.jsx(v,{children:"Silakan selesaikan pembayaran Anda"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Nomor Pesanan"}),e.jsx("span",{children:s.order_number})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Pembayaran"}),e.jsx("span",{className:"font-semibold",children:L(s.total_amount)})]}),t&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"text-sm text-red-700",children:t})})]})}),e.jsx(N,{className:"flex justify-center",children:e.jsx(y,{onClick:P,disabled:x||!o||!!t,className:"bg-batik-indigo hover:bg-batik-indigo/90 w-full",children:x?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Bayar Sekarang"]})})})]})]})})]})};export{G as default};
