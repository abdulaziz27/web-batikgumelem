import{r as n,u as S,j as a,S as d}from"./app-DmtSJND5.js";import{L as g}from"./Layout-Cu__wzhB.js";import{B as p}from"./index-CLYAcAfr.js";import{C as k,a as y,b,e as C,c as N,d as v}from"./card-veILkxu4.js";import{f as E}from"./formatters-BdPsR_AQ.js";import{C as B}from"./credit-card-CuS4hsOb.js";import{L}from"./loader-circle-ClLkAe_F.js";/* empty css            */import"./use-initials-CVwSWvl-.js";import"./Combination-Cc5t9BuF.js";import"./map-pin-ZiOjmX_x.js";import"./badge-CxcWWxTy.js";const z=({order:e,payment_url:t,midtrans_client_key:x,is_production:h})=>{const[u,r]=n.useState(!1),[l,w]=n.useState(""),[i,m]=n.useState(null);let f=()=>{};try{f=S().clearCart}catch{console.warn("Cart provider not available, using fallback")}n.useEffect(()=>{if(!e||!e.id){m("Data pesanan tidak valid"),console.error("Invalid order data:",e);return}!e.payment_token&&!e.payment_url&&console.warn("Payment token/URL missing - this means the payment wasn't properly initialized")},[e]),n.useEffect(()=>{if(i)return;let s="";if(e!=null&&e.payment_token)s=e.payment_token;else if(t&&t!=="null"){const o=t.match(/([^\/]+)$/);o&&o[1]&&(s=o[1])}w(s)},[e,t,i]),n.useEffect(()=>{if(i||!l)return;const s=document.getElementById("midtrans-script");s&&document.body.removeChild(s);const o=h?"https://app.midtrans.com/snap/snap.js":"https://app.sandbox.midtrans.com/snap/snap.js",c=document.createElement("script");return c.id="midtrans-script",c.src=o,c.setAttribute("data-client-key",x),c.onload=()=>console.log("Snap.js loaded successfully"),c.onerror=()=>m("Gagal memuat payment processor"),document.body.appendChild(c),()=>{const j=document.getElementById("midtrans-script");j&&document.body.removeChild(j)}},[l,i,h,x]),n.useEffect(()=>{try{f()}catch(s){console.warn("Error clearing cart:",s)}},[]),n.useEffect(()=>{console.log("Order data:",e),console.log("Payment URL:",t),console.log("Payment token:",e==null?void 0:e.payment_token)},[e,t]);const P=()=>{i||(r(!0),window.snap&&l?(console.log("Opening Snap payment modal with token:",l),window.snap.pay(l,{onSuccess:s=>{console.log("Payment success:",s),d.visit(`/checkout/success?order_id=${e.id}`)},onPending:s=>{console.log("Payment pending:",s),d.visit(`/checkout/success?order_id=${e.id}`)},onError:s=>{console.error("Payment error:",s),d.visit(`/checkout/cancel?order_id=${e.id}`)},onClose:()=>{console.log("Payment widget closed"),r(!1)}})):(console.error("Snap.js not loaded or token not available"),t&&t!=="null"?window.location.href=t:(m("Gateway pembayaran tidak tersedia"),r(!1))))};return i?a.jsx(g,{children:a.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:a.jsx("div",{className:"mx-auto max-w-3xl",children:a.jsxs(k,{children:[a.jsxs(y,{children:[a.jsx(b,{className:"text-red-600",children:"Terjadi Kesalahan"}),a.jsx(C,{children:"Tidak dapat memproses pembayaran saat ini"})]}),a.jsxs(N,{children:[a.jsx("p",{className:"text-gray-700",children:i}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Silakan coba lagi atau hubungi customer service kami"})]}),a.jsx(v,{children:a.jsx(p,{variant:"outline",asChild:!0,className:"mr-auto",children:a.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})})})}):a.jsx(g,{children:a.jsx("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"mx-auto max-w-3xl",children:[a.jsx("div",{className:"mb-8",children:a.jsx("h1",{className:"text-batik-brown text-2xl font-bold tracking-tight",children:"Pembayaran"})}),a.jsxs(k,{children:[a.jsxs(y,{children:[a.jsxs(b,{className:"flex items-center",children:[a.jsx(B,{className:"mr-2 h-5 w-5"}),"Selesaikan Pembayaran"]}),a.jsx(C,{children:"Pesanan Anda telah dibuat. Silakan selesaikan pembayaran untuk memproses pesanan Anda."})]}),a.jsxs(N,{children:[a.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[a.jsx("p",{className:"font-medium",children:"Detail Pesanan"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Nomor Pesanan: ",e==null?void 0:e.order_number]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ",E((e==null?void 0:e.total_amount)||0)]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Metode Pembayaran: ",(e==null?void 0:e.payment_method)==="bank_transfer"?"Transfer Bank":"E-Wallet"]})]}),a.jsxs("div",{className:"flex flex-col items-center justify-center",children:[a.jsx("p",{className:"mb-4 text-center",children:"Klik tombol di bawah untuk melanjutkan ke halaman pembayaran"}),a.jsx(p,{onClick:P,className:"bg-batik-indigo hover:bg-batik-indigo/90",disabled:u||!l,children:u?a.jsxs(a.Fragment,{children:[a.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})]})]}),a.jsx(v,{children:a.jsx(p,{variant:"outline",asChild:!0,className:"mr-auto",children:a.jsx("a",{href:"/",children:"Kembali ke Beranda"})})})]})]})})})};export{z as default};
